---
title: "타입스크립트 내려다보기"
date: "2023-06-23"
description: "타입스크립트 컴파일의 동작원리, 기능, 개발 패턴 등을 알아보자!"
education: "book"
---

### 목차

- 타입스크립트 컴파일러
- 타입 시스템
- 타입스크립트 vs 자바스크립트
- 코드 편집기 설정

# 타입스크립트 컴파일러

프로그램은 프로그래머가 작성한 다수의 텍스트 파일로 구성되고, 텍스트를 컴파일러라는 특별한 프로그램 파싱하여 추상 문법 트리(abstract syntax tree, AST)라는 자료구조로 변환한다.

AST(추상 문법 트리)는 공백, 주석, 그리고 컴파일러는 다시 AST를 바이트코드라는 하위 수준의 표현으로 변환한다. 바이트코드가 만들어졌으면 런타임이라는 다른 프로그램에 바이트코드를 입력해 평가하고 결과를 얻을 수 있다.

즉, 프로그램을 실행한다는 것은 컴파일러가 소스 코드를 파싱해 AST로 만들고, 다시 AST를 바이트코드로 변환한 것을 런타임이 평가하도록 지시한다는 의미이다.

모든 언어가 과정이 똑같지 않지만 대부분 언어가 이러한 과정으로 프로그램을 실행한다.

요약하자면

1. 프로그램이 AST로 파싱되고
2. AST가 바이트코드로 컴파일된다.
3. 런타임이 바이트코드를 평가한다.

타입스크립트가 다른 언어와 차이점은 타입스크립트 컴파일러는 코드를 바이트코드가 아닌 자바스크립트 코드로 변환하는 점이다.

그 이후로 일반적인 자바스크립트 코드를 실행하듯이 브라우저, NodeJS 등으로 실행할 수 있다.

여기서 중요한 것은 타입스크립트 컴파일러는 AST를 만들어 자바스크립트 코드로 변환하기 전에 타입 확인을 걸쳐 안정성을 높여준다.

> 타입 검사기 : 코드의 타입 안정성을 검증하는 특별한 프로그램

타입스크립트에서 타입 확인 덕분에 프로그램이 개발자의 기대대로 실행될 수 있게 해주고, 명백한 실수가 들어가지 않게 방지를 해준다.

타입스크립트의 컴파일 과정을 간력하게 설명 하자면

타입스크립트 컴파일 과정

1.  타입스크립트 소스 -> 타입스크립트 AST
2.  타입 검사기가 AST를 확인
3.  타입 스크립트 AST -> 자바스크립트 소스

자바스크립트 컴파일 과정

4. 자바스크립트 소스 -> 자바스립트 AST
5. AST -> 바이트코드
6. 런타임이 바이트 코드를 평가

1,2,3 과정 은 TSC가 수행하고, 4~6은 브라우저, NodeJS 등 JS 엔진 같은 자바스크립트 런타임이 수행한다.

> 보통 자바스크립트 컴파일러와 런타임은 엔진이라는 하나의 프로그램으로 합쳐진다. 프로그래머는 주로 이 엔진과 상호작용한다. V8(NodeJS, 크롬, 오페라에서 사용), 스파이더몽키(파이어폭스),JSCore(사파리), 샤크라(엣지) 등이 이처럼 동작하며 자바스크립트가 해석되는(interpreted) 언어의 모습을 갖게 만든다.

과정 1~2에서는 소스 코드에 사용된 타입을 이용하지만, 과정 3에서는 이용하지 않는다.
다시 말해, TSC가 타입스크립트 코드를 자바스크립트 코드로 컴파일 할 때 개발자가 사용한 타입을 확인하지 않는다.

개발자가 코드에 기입한 타입 정보는 최종적으로 만들어지는 프로그램에 아무런 영향을 주지 않으며, 단지 타입을 확인하는 데만 쓰인다.

# 타입 시스템

최신의 프로그래밍 언어는 저마다의 타입 시스템을 갖추고 있다.

> 타입 시스템 : 타입 검사기가 프로그램에 타입을 할당하는 데 사용하는 규칙 집합

타입 시스템은 어떤 타입을 사용하는지를 컴파일러에 명시적으로 알려주는 타입 시스템과 자동으로 타입을 추론하는 타입 시스템으로 두가지 종류가 있다.

타입스크립트는 두가지 시스템 모두 영향을 받았다.

그래서 우리는 타입을 명시하거나 추론하는 방식 중에서 선택할 수 있다.

타입스크립트에서 어노테이션을 이용해서 명시적으로 타입을 지정할 수 있다.

> 어노테이션 : value: type -> 이러한 형태로 쓰이며 검사기에게 타입을 알려준다.

```ts
let a: number = 1 // a는 number 타입
let b: string = "waterHumanB" // b는 string 타입
let c: boolean[] = [true, false] // c는 boolean 배열 타입
```

```ts
let a = 1 // a는 number 타입
let b = "waterHumanB" // b는 string 타입
let c = [true, false] // c는 boolean 배열 타입
```

첫번째 예시는 어노테이션을 사용하여 타입을 명시적으로 지정하였고, 두번째는 어노테이션을 사용하지 않고 타입스크립트가 알아서 타입을 추론해준다.

> TIP : 타입스크립트가 타입을 추론하도록 두는 것이 코드를 줄일 수 있는 방법이므로 보통 어노테이션을 생략한다.

# 타입스크립트 vs 자바스크립트

아래는 타입스크립트와 자바스크립트의 타입 시스템을 비교한 값을 표로 나타냈습니다.

| 타입 시스템 기능      | 자바스크립트   | 타입스크립트        |
| --------------------- | -------------- | ------------------- |
| 타입결정 방식         | 동적           | 정적                |
| 타입이 자동 변환 여부 | 자동           | 수동(대부분)        |
| 타입결정 방식         | 런타임         | 컴파일 타임         |
| 타입결정 방식         | 런타임(대부분) | 컴파일 타임(대부분) |

자바스크립트는 동적 타입 바인딩(dynamic type binding)으로 프로그램을 실행해야만 특정 데이터의 타입을 알 수 있습니다. 그말은 자바스크립트는 프로그램을 실행하기 전에는 타입을 알 수 없습니다.

타입스크립트는 점진적으로 타입을 확인하는(gradually typed) 언어로, 컴파일 타임에 프로그램의 모든 타입을 알고 있을 때 최상의 결과를 보여줄 수 있지만, 반드시 모든 타입을 알아야 하는 것은 아니다. 이유는 타입 추론을 통해 타입을 알 수 있지만, 만약 타입 추론을 통해서도 타입을 알지 못하면, 타입스크립트는 사용자에게 오류를 검출해준다.

**"자바스크립트는 자동으로 타입이 변화는 약한 타입의 언어이다"**

자바스크립트는 유효하지 않는 연산을 수행하면 다양한 규칙을 적용해가며 개발자가 정말 의도한 바를 알아내려고 노력하고, 주어진 정보로 최상의 결과를 도출한다.

예를 들어 7 + [7]의 연산을 자바스크립트는 "77"이라는 결과로 도출한다.

"77"이라는 결과를 도출해는 과정에서 자바스크립트는 암묵적으로 타입을 변환한다.
숫자 7은 문자열 "7"으로 암묵적인 타입 변화를 하고, 배열 [7]도 문자열 "7"으로 변환을 해서 결과를 도출한다.

자바스크립트는 영리하게 타입을 변환하여 개발자에게 어떻게든 결과를 도출하려고 하고, 타입스크립트는 유요하지 않는 작업을 발견하는 즉시 에러를 보여준다.

타입스크립트에서 7 + [7]이라는 연산을 진행 했다면,
"연산자 '+'는 '숫자' 및 '숫자[ ]' 유형에 적용할 수 없습니다." 이라는 오류가 발생한다.

이처럼 자바스크립트가 제공하는 암묵적인 타입 변화 떄문에 문제의 원인을 추적하기 어렵고, 자바스크립트 프로그래머의 골칫거리 이다. 코드가 암묵적으로 의미하는 바를 이해해야 하므로 엔지니어 각자가 자신의 작업을 완수 하기 어려워지고, 큰 팀을 구성해 코드를 확장할 때 큰 걸림돌이 된다.
그래서 타입을 변환할 때는 명시적으로 해야한다.

# 코드 편집기 설정

VSCode에서 typescript 설치하는 방법으로 node.js을 설치하고

- TSC, TSLint, NodeJS용 타입 선언 설치

  npm install --save-dev typescript tslint @types/node

- tsconfig.json

  모든 타입스크립트 프로젝트는 루트 디렉터리에 tsconfig.json 이라는 파일이 존재해야 한다.
  tsconfig.json파일은 타입스크립트의 프로젝트에서 어떤 파일을 컴파일하고, 어던 자바스크립트 버전을 방출하는지 등을 정의한다.

```ts
{
  "compilerOptions": {
    "lib": ["es2015"],
    "module": "CommonJS",
    "outDir": "dist",
    "sourceMap":true,
    "strict": true,
    "target": "es2015"
  },
  "include": ["src"],
}
```

위에 코드가 기본적으로 `tsconfig.json`에 설정하는 값들이다.

| 옵션    | 설명                                                                                                                                           |
| ------- | ---------------------------------------------------------------------------------------------------------------------------------------------- |
| include | TSC가 타입스크립트 파일을 찾는 디렉터리                                                                                                        |
| lib     | TSC가 코드 실행 환경에서 이용할 수 있다고 가정하는 API(ES5의 Function.prototype.bind, ES2015의 object.assign, DOM의 document.querySelector 등) |
| module  | TSC가 코드를 컴파일할 대상 모듈 시스템(CommonJS, SystemJS,ES2015 등)                                                                           |
| outDir  | 생성된 자바스크립트 코드를 출력할 디렉터리                                                                                                     |
| strict  | 유효하지 않은 코드를 확인할 때 가능한 한 엄격하게 검사. 이 옵션을 이용하면 코드가 적절하게 타입을 갖추도록 강제할 수 있다.                     |
| target  | TSC가 코드를 컴파일할 자바스크립트 버전(ES3,ES5,ES2015,ES2016 등)                                                                              |

위 셋팅에서 옵션을 추가하거나 수정할 수 있다. 지원 하는 모든 최신 옵션은 [타입스크립트 공식문서](https://www.typescriptlang.org/docs/handbook/tsconfig-json.html#handbook-content) 에서 확인할 수 있다.

> 경고: TSLint는 2019년부터 더 이상 사용되지 않습니다 . 자세한 내용은 이 문제를 참조하십시오: 로드맵: TSLint → ESLint . typescript-eslint는 이제 TypeScript 린팅을 위한 최상의 옵션입니다.
>
> TSLint는 TypeScript 코드의 가독성, 유지 관리성 및 기능 오류를 검사하는 확장 가능한 정적 분석 도구입니다 . 최신 편집기 및 빌드 시스템에서 광범위하게 지원되며 고유한 Lint 규칙, 구성 및 포맷터로 사용자 정의할 수 있습니다.
>
> [TSLint GitHub](https://palantir.github.io/tslint/)에서 설명글입니다.

### 참고 도서

https://product.kyobobook.co.kr/detail/S000001033092
